# AWS リソース削除手順

すべてのAWSリソースを削除して課金を$0にするための手順。

> ⚠️ 順番が重要。依存関係があるため、上から順に削除すること。

---

## Step 1: ECSサービス & クラスター削除

```bash
# サービス停止 & 削除
aws ecs update-service \
  --cluster github-analyzer-cluster \
  --service github-analyzer-service \
  --desired-count 0

aws ecs delete-service \
  --cluster github-analyzer-cluster \
  --service github-analyzer-service

# クラスター削除
aws ecs delete-cluster --cluster github-analyzer-cluster
```

## Step 2: ALB削除

```
EC2 → ロードバランサー → github-analyzer-alb → アクション → 削除
```

## Step 3: ターゲットグループ削除

```
EC2 → ターゲットグループ → github-analyzer-tg → アクション → 削除
```

## Step 4: RDS削除

```
RDS → github-analyzer-db → アクション → 削除
```

- 「最終スナップショットを作成しますか？」→ **チェックを外す**
- 「自動バックアップを保持しますか？」→ **チェックを外す**

### スナップショット確認（重要！）

```
RDS → 左メニュー「スナップショット」→ 残っていたら削除
```

> ⚠️ スナップショットが残っているとストレージ課金が続く

## Step 5: ECRリポジトリ削除

```
ECR → github-analyzer → 削除
```

## Step 6: セキュリティグループ削除

```
VPC → セキュリティグループ → 以下の3つを削除
```

- `github-analyzer-alb-sg`
- `github-analyzer-ecs-sg`
- `github-analyzer-rds-sg`

> ※ `default` セキュリティグループは削除不要（VPC削除時に消える）

## Step 7: VPC削除

```
VPC → github-analyzer-vpc → アクション → VPCの削除
```

> サブネット・Internet Gateway・ルートテーブルも一緒に削除される

## Step 8: 残留リソース確認

念のため以下を確認:

```
EC2 → Elastic IP → 何も残っていないこと
EC2 → ネットワークインターフェース → 何も残っていないこと
CloudWatch → ロググループ → /ecs/ 関連が残っていたら削除
RDS → スナップショット → 何も残っていないこと
```

---

## 確認完了

すべて削除後、AWS課金は **$0** になる。